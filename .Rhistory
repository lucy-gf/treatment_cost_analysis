data <- data.table(read_xlsx(here::here('data','Umbrella review data LG.xlsx')))[!is.na(th),] # remove empty rows
costs_dt <- data[, c('th','country','iso3c','currency','currency_iso3c','study_year','currency_year','study_pop',
'outcome','cost')]
costs_dt[is.na(study_year), study_year := currency_year]
costs_dt[, study_year := as.numeric(study_year)]
## back into local currency
# WDIsearch('exchange')
if(!exists('lcu_rates')){lcu_rates <- data.table(WDI(indicator='PA.NUS.FCRF', start=min(costs_dt$study_year), end=main_year))}
lcu_rates[, study_year := year]
costs_dt <- costs_dt[lcu_rates, on = c('iso3c', 'study_year'), lcu_rate_study_year := i.PA.NUS.FCRF]
costs_dt <- costs_dt[lcu_rates[study_year==main_year], on = c('iso3c'), lcu_rate_main_yr := i.PA.NUS.FCRF]
costs_dt[iso3c == 'TWN' & study_year == 2010, lcu_rate_study_year := 31.5]
costs_dt[iso3c == 'TWN' & study_year == 2010, lcu_rate_main_yr := 29.8]
## inflate to $ main year
if(!exists('deflate_rates')){deflate_rates <- data.table(WDI(indicator='NY.GDP.DEFL.ZS', start=min(costs_dt$study_year), end=main_year))}
deflate_rates[, currency_year := year][, study_year := year][, currency_iso3c := iso3c]
costs_dt <- costs_dt[deflate_rates, on = c('currency_iso3c', 'study_year'), study_yr_defl_rate_c := i.NY.GDP.DEFL.ZS]
costs_dt <- costs_dt[deflate_rates, on = c('currency_iso3c', 'currency_year'), curr_yr_defl_rate_c := i.NY.GDP.DEFL.ZS]
costs_dt <- costs_dt[deflate_rates, on = c('iso3c', 'study_year'), study_yr_defl_rate_i := i.NY.GDP.DEFL.ZS]
costs_dt <- costs_dt[deflate_rates[year==main_year,], on = c('iso3c'), defl_rate_main_yr_i := i.NY.GDP.DEFL.ZS]
costs_dt[, inflator_curr_to_stud_c := curr_yr_defl_rate_c/study_yr_defl_rate_c]
costs_dt[, inflator_stud_to_main_i := defl_rate_main_yr_i/study_yr_defl_rate_i]
if(sum(costs_dt[currency_iso3c != iso3c]$currency_iso3c != 'USA') > 0){
print('Warning: some costs not in either local currency or USD')
}
# TURN COSTS IN CURRENCY (E.G. USD) INTO STUDY YEAR COSTS IN SAME CURRENCY
costs_dt[, cost_stud_c := cost/inflator_curr_to_stud_c]
# CONVERT TO LCU IN STUDY YEAR
costs_dt[currency_iso3c == 'USA', cost_stud_i := cost_stud_c*lcu_rate_study_year]
costs_dt[currency_iso3c == iso3c, cost_stud_i := cost_stud_c]
# INFLATE TO MAIN YEAR IN LCU
costs_dt[, cost_main_yr_i := cost_stud_i*inflator_stud_to_main_i][, cost_usd_main_yr := cost_lcu_main_yr/lcu_rate]
costs_dt
View(costs_dt[, c('iso3c','currency_iso3c','study_year','currency_year','cost','cost_stud_c','cost_stud_i','cost_main_yr_i')])
lcu_rates
View(lcu_rates)
# CONVERT TO MAIN YEAR USD
costs_dt[, cost_usd_main_yr := cost_main_yr_i/lcu_rate_main_yr]
costs_dt
## adding GDP per capita
gdp_data <- WDI(indicator='NY.GDP.PCAP.KD', start=main_year, end=main_year)
costs_gdp <- data.table(merge(costs_dt, gdp_data, by = c('iso3c')))
setnames(costs_gdp, 'NY.GDP.PCAP.KD', 'gdpcap')
setnames(costs_gdp, 'country.x','country')
costs_gdp <- costs_gdp[,c('th','country','iso3c','currency_iso3c','study_year','currency_year','study_pop','outcome','cost_usd_main_yr','gdpcap')]
costs_gdp
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + #scale_y_log10() + scale_x_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
# healthcare expenditure per capita as a proportion of GDP per capita
# NOTE - using 2021 as is most recent data - need to find other source to update this
hce_data <- data.table(WDI(indicator='SH.XPD.CHEX.PC.CD', start=2021, end=2021))
costs_gdp <- costs_gdp[hce_data[iso3c %in% costs_gdp$iso3c,][,c('iso3c','SH.XPD.CHEX.PC.CD')], on = c('iso3c')]
setnames(costs_gdp, 'SH.XPD.CHEX.PC.CD', 'hce_cap')
costs_gdp[, hce_prop_gdp := hce_cap/gdpcap]
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
costs_gdp
# initialising
library(here)
source(here::here('scripts','setup','packages.R'))
source(here::here('scripts','setup','aesthetics.R'))
main_year <- 2023
# loading data
data <- data.table(read_xlsx(here::here('data','Umbrella review data LG.xlsx')))[!is.na(th),] # remove empty rows
# cleaning data
source(here::here('scripts','data_cleaning.R'))
use_hosp <- costs_gdp[outcome=='hosp']
use_outp <- costs_gdp[outcome=='outp']
?brm
lm_hosp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_hosp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
lm_hosp
lm_outp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_outp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
lm_outp
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_cap, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
hce_prop_gdp
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
summary(lm_hosp)
summary(lm_outp)
brms::conditional_effects(lm_hosp)
conditions <- data.frame(study_pop = unique(use$study_pop))
conditions <- data.frame(study_pop = unique(costs_gdp$study_pop))
facet_output <- brms::conditional_effects(lm_outp, conditions = conditions,
re_formula = NULL, method = "predict")
plot(facet_output, points = TRUE)
use_outp <- costs_gdp[outcome=='outp' & study_pop != 'adults']
lm_hosp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_hosp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
lm_outp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_outp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
summary(lm_outp)
use_outp
brms::conditional_effects(lm_outp)
use_outp <- costs_gdp[outcome=='outp' & study_pop != 'adult']
lm_outp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_outp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
summary(lm_outp)
brms::conditional_effects(lm_outp)
conditions <- data.frame(study_pop = unique(costs_gdp$study_pop))
facet_output <- brms::conditional_effects(lm_outp, conditions = conditions,
re_formula = NULL, method = "predict")
conditions <- data.frame(study_pop = unique(use_outp$study_pop))
facet_output <- brms::conditional_effects(lm_outp, conditions = conditions,
re_formula = NULL, method = "predict")
plot(facet_output, points = TRUE)
output <- data.table(facet_output[[3]])
ggplot(output) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
facet_output
output
ggplot(output) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(output) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
output <- data.table(facet_output[[4]])
ggplot(output) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
ggplot(output) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
ggplot(output) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
output
lm_outp
output_gdp
output_gdp <- data.table(facet_output[[4]])
output_gdp <- data.table(facet_output[[4]])
ggplot(output_gdp) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
ggplot(output_gdp) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
output_gdp
ggplot(output_gdp) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
ggplot(output_gdp) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(output_gdp) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
ggplot(output_gdp) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
?conditional_effects
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__), alpha=0.3) +
geom_line(aes(gdpcap, estimate__), lwd=0.8, col='red') +
facet_grid(study_pop~., scales='free') +
# scale_x_log10() + scale_y_log10() +
theme_bw()
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
data.table(facet_output[[4]])
data.table(facet_output[[5]])
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + #scale_y_log10() + scale_x_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
# initialising
library(here)
source(here::here('scripts','setup','packages.R'))
source(here::here('scripts','setup','aesthetics.R'))
main_year <- 2023
# loading data
data <- data.table(read_xlsx(here::here('data','Umbrella review data LG.xlsx')))[!is.na(th),] # remove empty rows
data
# cleaning data
source(here::here('scripts','data_cleaning.R'))
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
# producing model
source(here::here('scripts','model_run.R'))
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
summary(lm_hosp)
summary(lm_outp)
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
summary(lm_hosp)
plot(facet_output, points = TRUE)
facet_output
conditions
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
summary(lm_hosp)
conditions <- data.frame(study_pop = unique(use_hosp$study_pop))
facet_output <- brms::conditional_effects(lm_hosp, conditions = conditions,
re_formula = NULL, method = "predict")
plot(facet_output, points = TRUE)
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
data.table(facet_output[[4]])
?conditional_effects
conditions
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + #scale_y_log10() + scale_x_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + scale_y_log10() + scale_x_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
facet_output
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
costs_gdp
costs_gdp
View(costs_gdp)
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + scale_y_log10() + scale_x_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + scale_y_log10() + scale_x_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + #scale_y_log10() + scale_x_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + scale_y_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + #scale_y_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + scale_y_log10() +
facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
hce_data
# initialising
library(here)
source(here::here('scripts','setup','packages.R'))
source(here::here('scripts','setup','aesthetics.R'))
main_year <- 2023
# loading data
data <- data.table(read_xlsx(here::here('data','Merged Flu Cost Data.xlsx')))[!is.na(th),] # remove empty rows
data
# cleaning data
source(here::here('scripts','data_cleaning.R'))
use_hosp <- costs_gdp[outcome=='hosp']
use_outp <- costs_gdp[outcome=='outp' & study_pop != 'adult']
lm_hosp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_hosp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
lm_outp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_outp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
summary(lm_hosp)
summary(lm_outp)
use_outp
unique(use_outp$study_pop)
data
unique(data[outcome=='outp']$study_pop)
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=gdpcap, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
use_outp <- costs_gdp[outcome=='outp']
lm_outp <- brms::brm(cost_usd_main_yr ~ study_pop*(gdpcap + hce_prop_gdp) + (1|iso3c),
data = use_outp,
family = lognormal('identity', link_sigma='log'),
chains = 3, cores = 3, iter = 4000)
summary(lm_outp)
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=gdp_cap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
summary(lm_hosp)
brms::conditional_effects(lm_hosp)
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
brms::conditional_effects(lm_outp)
ggplot(costs_gdp) +
geom_point(aes(x=gdpcap, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
conditions <- data.frame(study_pop = unique(use_hosp$study_pop))
facet_output <- brms::conditional_effects(lm_hosp, conditions = conditions,
re_formula = NULL, method = "predict")
plot(facet_output, points = TRUE)
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=iso3c)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(costs_gdp) +
geom_point(aes(x=hce_prop_gdp, y=cost_usd_main_yr, col=gdpcap)) +
theme_bw() + facet_grid(outcome ~ study_pop, scales = 'free_y')
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[4]])) +
geom_ribbon(aes(x=gdpcap, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(gdpcap, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
View(deflate_rates)
lm_hosp <- brms::brm(cost_usd_main_yr ~ study_pop*(log(gdpcap) + hce_prop_gdp) + (1|iso3c),
data = use_hosp,
family = gaussian(),
chains = 3, cores = 3, iter = 4000)
lm_hosp
summary(lm_hosp)
summary(lm_outp)
brms::conditional_effects(lm_hosp)
family = gaussian(),
lm_hosp <- brms::brm(log(cost_usd_main_yr) ~ study_pop*(log(log(gdpcap)) + hce_prop_gdp) + (1|iso3c),
data = use_hosp,
family = gaussian(),
chains = 3, cores = 3, iter = 4000)
summary(lm_hosp)
brms::conditional_effects(lm_hosp)
conditions <- data.frame(study_pop = unique(use_hosp$study_pop))
facet_output <- brms::conditional_effects(lm_hosp, conditions = conditions,
re_formula = NULL, method = "predict")
plot(facet_output, points = TRUE)
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
ggplot(data.table(facet_output[[5]])) +
geom_ribbon(aes(x=hce_prop_gdp, ymin=lower__, ymax=upper__, group=study_pop), alpha=0.2) +
geom_line(aes(hce_prop_gdp, estimate__, col=study_pop), lwd=1) +
scale_x_log10() + scale_y_log10() +
facet_grid(cond__~.) +
theme_bw() + scale_color_manual(values = age_colors)
# healthcare expenditure per capita as a proportion of GDP per capita
# using 2022 as is most recent data
if(!exists('hce_data')){hce_data <- data.table(WDI(indicator='SH.XPD.CHEX.PC.CD', start=2022, end=2022))}
library(readxl)
X_saiefy1920finalqaddownload280923_1_ <- read_excel("~/Downloads/~$saiefy1920finalqaddownload280923 (1).xlsx")
library(readxl)
X_saiefy1920finalqaddownload280923_1_ <- read_excel("~/Downloads/~$saiefy1920finalqaddownload280923 (1).xlsx", sheet = 4)
library(readxl)
saiefy1920finalqaddownload280923 <- read_excel("~/Downloads/saiefy1920finalqaddownload280923.xlsx",
sheet = "Total annual income", skip = 3)
View(saiefy1920finalqaddownload280923)
hist(saiefy1920finalqaddownload280923$`Total annual income (£)`)
options(scipen = 10000000)
options(scipen = 100)
hist(saiefy1920finalqaddownload280923$`Total annual income (£)`)
quantile(saiefy1920finalqaddownload280923$`Total annual income (£)`)
quantile(saiefy1920finalqaddownload280923$`Total annual income (£)`, c(0,0.025, 0.25, 0.5, 0.75, 0.975, 1))
mean(c(0.4, 0.6, 0.6, 0.6, 0.4))
